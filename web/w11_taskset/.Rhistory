getwd()
source("scripts/import_est_from_osf.R")
getwd()
source("scripts/import_est_from_osf.R")
file.create("/scripts.test.R")
file.create("scripts/test.R")
source("scripts/import_est_from_osf.R")
list.files("data/raw")
list.files(here("data/raw"), pattern = "^est-experiment-.*\\.csv$", full.names = TRUE)
process_participant <- function(file_name) {
## Derive a subject id from the filename (no extension)
subject_id <- sub("\\.csv$", "", basename(file_name))
}
process_participant("est-experiment-2025-11-05-10-11-45.csv")
process_participant <- function(file_name) {
## Derive a subject id from the filename (no extension)
subject_id <- sub("\\.csv$", "", basename(file_name))
return(subject_id)
}
process_participant("est-experiment-2025-11-05-10-11-45.csv")
list.files(here("data/raw"), pattern = "^est-experiment-.*\\.csv$", full.names = FALSE)
process_participant <- function(file_name) {
subject_id <- sub("\\.csv$", "", basename(file_name))
return(subject_id)
df <- read.csv(here("data/raw/file_name"),
stringsAsFactors = FALSE)
str(df)
head(df)
names(df)
}
process_participant("est-experiment-2025-11-05-10-11-45.csv")
process_participant <- function(file_name) {
subject_id <- sub("\\.csv$", "", basename(file_name))
df <- read.csv(here("data/raw/file_name"),
stringsAsFactors = FALSE)
str(df)
head(df)
names(df)
}
process_participant("est-experiment-2025-11-05-10-11-45.csv")
process_participant <- function(file_name) {
subject_id <- sub("\\.csv$", "", basename(file_name))
df <- read.csv(here("data", "raw",file_name),
stringsAsFactors = FALSE)
str(df)
head(df)
names(df)
}
process_participant("est-experiment-2025-11-05-10-11-45.csv")
file.create("scripts/compute_rt_if_missing.R")
compute_rt_if_missing_l <- function(data) {
for (i in 1:nrow(file_name)) {
if(is.na(data$rt[i]) &
!is.na(data$stim_onset_ms[i]) &
!is.na(data$resp_time_ms[i]) &
!is.na(data$response[i])){
data$rt[i] <- data$resp_time_ms[i] - data$stim_onset_ms[i]
} else if (is.na(data$response[i])) {
data$rt[i] <- NA
}
}
data
}
compute_rt_if_missing_v <- function(data){
miss_rt <- is.na(data$rt)
stim_resp_values <- !is.na(data$stim_onset_ms) &
!is.na(data$resp_time_ms) &
!is.na(data$response)
data$rt[miss_rt & stim_resp_values] <-
data$resp_time_ms[miss_rt & stim_resp_values] -
data$stim_onset_ms[miss_rt & stim_resp_values]
data$rt[is.na(response)] <- NA
data
}
compute_rt_if_missing_l("data/est-experiment-2025-11-05-09-07-45.csv")
getwd()
compute_rt_if_missing_l("data/raw/est-experiment-2025-11-05-09-07-45.csv")
compute_rt_if_missing_l(read.csv("data/raw/est-experiment-2025-11-05-09-07-45.csv"))
df<- read.csv("data/raw/est-experiment-2025-11-05-09-07-45.csv")
compute_rt_if_missing_l(df)
compute_rt_if_missing_l <- function(data) {
for (i in 1:nrow(data)) {
if(is.na(data$rt[i]) &
!is.na(data$stim_onset_ms[i]) &
!is.na(data$resp_time_ms[i]) &
!is.na(data$response[i])){
data$rt[i] <- data$resp_time_ms[i] - data$stim_onset_ms[i]
} else if (is.na(data$response[i])) {
data$rt[i] <- NA
}
}
data
}
compute_rt_if_missing_l(df)
df1 <- compute_rt_if_missing_l(df)
View(df1)
compute_rt_if_missing_v <- function(data){
miss_rt <- is.na(data$rt)
stim_resp_values <- !is.na(data$stim_onset_ms) &
!is.na(data$resp_time_ms) &
!is.na(data$response)
print(data$rt[miss_rt & stim_resp_values])
data$rt[miss_rt & stim_resp_values] <-
data$resp_time_ms[miss_rt & stim_resp_values] -
data$stim_onset_ms[miss_rt & stim_resp_values]
print(data$rt[miss_rt & stim_resp_values])
data$rt[is.na(response)] <- NA
data
}
df1 <- compute_rt_if_missing_v(df)
View(df)
compute_rt_if_missing_v <- function(data){
miss_rt <- is.na(data$rt)
stim_resp_values <- !is.na(data$stim_onset_ms) &
!is.na(data$resp_time_ms) &
!is.na(data$response)
print(data$rt[miss_rt & stim_resp_values])
data$rt[miss_rt & stim_resp_values] <-
data$resp_time_ms[miss_rt & stim_resp_values] -
data$stim_onset_ms[miss_rt & stim_resp_values]
print(data$rt[miss_rt & stim_resp_values])
data$rt[is.na(data$response)] <- NA
data
}
df1 <- compute_rt_if_missing_v(df)
compute_rt_if_missing_v(df)
compute_rt_if_missing_v <- function(data){
miss_rt <- is.na(data$rt)
stim_resp_values <- !is.na(data$stim_onset_ms) &
!is.na(data$resp_time_ms) &
!is.na(data$response)
print(mean(data$rt, na.rm=TRUE))
data$rt[miss_rt & stim_resp_values] <-
data$resp_time_ms[miss_rt & stim_resp_values] -
data$stim_onset_ms[miss_rt & stim_resp_values]
print(mean(data$rt, na.rm=TRUE))
data$rt[is.na(data$response)] <- NA
data
}
compute_rt_if_missing_v(df)
compute_rt_if_missing_v <- function(data){
miss_rt <- is.na(data$rt)
stim_resp_values <- !is.na(data$stim_onset_ms) &
!is.na(data$resp_time_ms) &
!is.na(data$response)
print(mean(data$rt, na.rm=TRUE))
data$rt[miss_rt & stim_resp_values] <-
data$resp_time_ms[miss_rt & stim_resp_values] -
data$stim_onset_ms[miss_rt & stim_resp_values]
print(mean(data$rt, na.rm=TRUE))
data$rt[is.na(data$response)] <- NA
}
compute_rt_if_missing_v(df)
score_questionnaire <- function(json_string,
reverse = c(2,5,9),
scale_min=0L,
scale_max=4L){
# If the JSON string is missing or empty, return a numeric NA
if (is.null(json_string) || is.na(json_string) || !nzchar(json_string)) {
return(NA_real_)
}
## 1) Parse the JSON string into an R object
responses <- jsonlite::fromJSON(json_string)
## 2) Flatten and convert to numeric
responses <- as.numeric(unlist(responses))
## 3) Reverse-score the specified items
if(length(reverse) > 0) {
responses[reverse] <- scale_max + scale_min - responses[reverse]
}
return(sum(responses))
}
file_create("scripts/summarize_behavior.R")
summarize_behavior <- function(data, rt_min = 300, rt_max = 900) {
## Change correct column to logical
if (!is.logical(data$correct)) {
data$correct <- as.logical(data$correct)
}
mean_accuracy <- mean(data$correct, na.rm=TRUE)
mean_rt_correct <- mean(data$rt[correct==TRUE &
rt<rt_max & rt>rt_min], na.rm=TRUE)
participant_summary <- data.frame(
mean_accuracy   = mean_accuracy,
mean_rt_correct = mean_rt_correct)
}
summarize_behavior(df)
View(df)
summarize_behavior <- function(data, rt_min = 300, rt_max = 900) {
## Change correct column to logical
if (!is.logical(data$correct)) {
data$correct <- as.logical(data$correct)
}
mean_accuracy <- mean(data$correct, na.rm=TRUE)
mean_rt_correct <- mean(data$rt[data$correct==TRUE &
data$rt<rt_max & data$rt>rt_min], na.rm=TRUE)
participant_summary <- data.frame(
mean_accuracy   = mean_accuracy,
mean_rt_correct = mean_rt_correct)
}
summarize_behavior(df)
View(summarize_behavior)
summarize_behavior(df)
summarize_behavior <- function(data, rt_min = 300, rt_max = 900) {
## Change correct column to logical
if (!is.logical(data$correct)) {
data$correct <- as.logical(data$correct)
}
mean_accuracy <- mean(data$correct, na.rm=TRUE)
mean_rt_correct <- mean(data$rt[data$correct==TRUE &
data$rt<rt_max & data$rt>rt_min], na.rm=TRUE)
participant_summary <- data.frame(
mean_accuracy   = mean_accuracy,
mean_rt_correct = mean_rt_correct)
participant_summary
}
summarize_behavior(df)
summarize_behavior <- function(data, rt_min = 300, rt_max = 900) {
## Change correct column to logical
if (!is.logical(data$correct)) {
data$correct <- as.logical(data$correct)
}
mean_accuracy <- mean(data$correct, na.rm=TRUE)
mean_rt_correct <- mean(data$rt[data$correct==TRUE &
data$rt<rt_max & data$rt>rt_min], na.rm=TRUE)
participant_summary <- data.frame(
mean_accuracy   = mean_accuracy,
mean_rt_correct = mean_rt_correct)
return(participant_summary)
}
score_questionnaire(
json_string = df[df$trialType == "es_questionnaire", "response"]
)
process_participant <- function(file_name) {
subject_id <- sub("\\.csv$", "", basename(file_name))
df <- read.csv(here("data", "raw",file_name),
stringsAsFactors = FALSE)
score <- score_questionnaire(
json_string = df[df$trialType == "es_questionnaire", "response"]
)
behavior <- summarize_behavior(df)
rt <- compute_rt_if_missing_v(df)
df <- data.frame(
subject_id = subject_id,
score = score,
mean_accuracy = behavior$mean_accuracy,
mean_rt_correct = behavior$mean_rt_correct
)
write.csv(
df,
here::here("data", "cleaned", paste0(subject_id, "_processed.csv")),
row.names = FALSE
)
return(df)
}
file_list <- list.files(here("data/raw"), pattern = "^est-experiment-.*\\.csv$", full.names = FALSE)
participant_rows <- lapply(file_list, process_participant)
compute_rt_if_missing_v(df)
View(df)
compute_rt_if_missing_v <- function(data){
miss_rt <- is.na(data$rt)
stim_resp_values <- !is.na(data$stim_onset_ms) &
!is.na(data$resp_time_ms) &
!is.na(data$response)
data$rt[miss_rt & stim_resp_values] <-
data$resp_time_ms[miss_rt & stim_resp_values] -
data$stim_onset_ms[miss_rt & stim_resp_values]
}
compute_rt_if_missing_v(df)
compute_rt_if_missing_v <- function(data){
miss_rt <- is.na(data$rt)
stim_resp_values <- !is.na(data$stim_onset_ms) &
!is.na(data$resp_time_ms) &
!is.na(data$response)
data$rt[miss_rt & stim_resp_values] <-
data$resp_time_ms[miss_rt & stim_resp_values] -
data$stim_onset_ms[miss_rt & stim_resp_values]
return(data$rt)
}
compute_rt_if_missing_v(df)
process_participant <- function(file_name) {
subject_id <- sub("\\.csv$", "", basename(file_name))
df <- read.csv(here("data", "raw",file_name),
stringsAsFactors = FALSE)
score <- score_questionnaire(
json_string = df[df$trialType == "es_questionnaire", "response"]
)
df$rt <- compute_rt_if_missing_v(df)
behavior <- summarize_behavior(df)
df <- data.frame(
subject_id = subject_id,
score = score,
mean_accuracy = behavior$mean_accuracy,
mean_rt_correct = behavior$mean_rt_correct
)
write.csv(
df,
here::here("data", "cleaned", paste0(subject_id, "_processed.csv")),
row.names = FALSE
)
}
process_participant(df)
file_list <- list.files(here("data/raw"), pattern = "^est-experiment-.*\\.csv$", full.names = FALSE)
participant_rows <- lapply(file_list, process_participant)
study_level <- do.call(rbind, participant_rows)
file_list
process_participant("est-experiment-2025-11-05-10-15-45.csv")
names(participant_rows[[1]])
file_list <- list.files(here("data/raw"), pattern = "^est-experiment-.*\\.csv$", full.names = FALSE)
participant_rows <- lapply(file_list, process_participant)
participant_rows <- lapply(file_list, process_participant)
traceback()
participant_rows <- lapply(file_list, process_participant)
traceback()
participant_rows <- lapply(file_list, process_participant)
traceback()
names(participant_rows[[1]])
file_list
process_participant("est-experiment-2025-11-05-09-19-45.csv")
wd <- process_participant("est-experiment-2025-11-05-09-19-45.csv")
participant_rows <- lapply(file_list, process_participant)
summarize_behavior <- function(data, rt_min = 300, rt_max = 900) {
## Change correct column to logical
if (!is.logical(data$correct)) {
data$correct <- as.logical(data$correct)
}
mean_accuracy <- mean(data$correct, na.rm=TRUE)
mean_rt_correct <- mean(data$rt[data$correct==TRUE &
data$rt<rt_max & data$rt>rt_min], na.rm=TRUE)
participant_summary <- data.frame(
mean_accuracy   = mean_accuracy,
mean_rt_correct = mean_rt_correct)
return(participant_summary)
}
compute_rt_if_missing_v <- function(data){
miss_rt <- is.na(data$rt)
stim_resp_values <- !is.na(data$stim_onset_ms) &
!is.na(data$resp_time_ms) &
!is.na(data$response)
data$rt[miss_rt & stim_resp_values] <-
data$resp_time_ms[miss_rt & stim_resp_values] -
data$stim_onset_ms[miss_rt & stim_resp_values]
return(data$rt)
}
summarize_behavior <- function(data, rt_min = 300, rt_max = 900) {
## Change correct column to logical
if (!is.logical(data$correct)) {
data$correct <- as.logical(data$correct)
}
mean_accuracy <- mean(data$correct, na.rm=TRUE)
mean_rt_correct <- mean(data$rt[data$correct==TRUE &
data$rt<rt_max & data$rt>rt_min], na.rm=TRUE)
participant_summary <- data.frame(
mean_accuracy   = mean_accuracy,
mean_rt_correct = mean_rt_correct)
return(participant_summary)
}
process_participant <- function(file_name) {
subject_id <- sub("\\.csv$", "", basename(file_name))
df <- read.csv(here("data", "raw",file_name),
stringsAsFactors = FALSE)
score <- score_questionnaire(
json_string = df[df$trialType == "es_questionnaire", "response"]
)
df$rt <- compute_rt_if_missing_v(df)
behavior <- summarize_behavior(df)
df <- data.frame(
subject_id = subject_id,
score = score,
mean_accuracy = behavior$mean_accuracy,
mean_rt_correct = behavior$mean_rt_correct
)
write.csv(
df,
here::here("data", "cleaned", paste0(subject_id, "_processed.csv")),
row.names = FALSE
)
}
score_questionnaire <- function(json_string,
reverse = c(2,5,9),
scale_min=0L,
scale_max=4L){
# If the JSON string is missing or empty, return a numeric NA
## 1) Parse the JSON string into an R object
responses <- jsonlite::fromJSON(json_string)
## 2) Flatten and convert to numeric
responses <- as.numeric(unlist(responses))
## 3) Reverse-score the specified items
if(length(reverse) > 0) {
responses[reverse] <- scale_max + scale_min - responses[reverse]
}
return(sum(responses))
}
participant_rows <- lapply(file_list, process_participant)
names(participant_rows[[1]])
participant_rows <- lapply(file_list, process_participant)
score_questionnaire <- function(json_string,
reverse = c(2,5,9),
scale_min=0L,
scale_max=4L){
# If the JSON string is missing or empty, return a numeric NA
if (is.null(json_string) ||
length(json_string) == 0 ||
is.na(json_string) ||
!nzchar(json_string) ||
!jsonlite::validate(json_string)) {
return(NA_real_)
}
## 1) Parse the JSON string into an R object
responses <- jsonlite::fromJSON(json_string)
## 2) Flatten and convert to numeric
responses <- as.numeric(unlist(responses))
## 3) Reverse-score the specified items
if(length(reverse) > 0) {
responses[reverse] <- scale_max + scale_min - responses[reverse]
}
return(sum(responses))
}
participant_rows <- lapply(file_list, process_participant)
study_level <- do.call(rbind, participant_rows)
names(participant_rows[[1]])
names(participant_rows[[2]])
participant_rows
study_level <- do.call(rbind, participant_rows)
file_list <- list.files(here("data/raw"), pattern = "^est-experiment-.*\\.csv$", full.names = FALSE)
participant_rows <- lapply(file_list, process_participant)
study_level <- do.call(rbind, participant_rows)
traceback()
View(participant_rows)
process_participant <- function(file_name) {
subject_id <- sub("\\.csv$", "", basename(file_name))
df <- read.csv(here("data", "raw",file_name),
stringsAsFactors = FALSE)
score <- score_questionnaire(
json_string = df[df$trialType == "es_questionnaire", "response"]
)
df$rt <- compute_rt_if_missing_v(df)
behavior <- summarize_behavior(df)
df <- data.frame(
subject_id = subject_id,
score = score,
mean_accuracy = behavior$mean_accuracy,
mean_rt_correct = behavior$mean_rt_correct
)
write.csv(
df,
here::here("data", "cleaned", paste0(subject_id, "_processed.csv")),
row.names = FALSE
)
return(df)
}
participant_rows <- lapply(file_list, process_participant)
study_level <- do.call(rbind, participant_rows)
names(participant_rows[[1]])
names(participant_rows[[2]])
names(participant_rows[[1]])
View(study_level)
knitr::kable(study_level)
getwd()
setwd("C:/Users/mayak/Desktop/psy1903/web/w11_taskset")
file_create(".here")
backtrace()
View(study_level)
traceback()
